name: build sb3

on: push

jobs:
    elc:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - name: checkout elvm
              uses: actions/checkout@v4
              with:
                  repository: shinh/elvm
                  path: elvm
            - name: build elc
              run: npm install -g scratch-vm && cd elvm && make && cp ./out/elc .. && cp -r ./tools/ .. && cd ..
            - name: upload everythinh
              uses: actions/upload-artifact@v4
              with:
                  name: elc
                  path: ./
    build:
        runs-on: ubuntu-latest
        needs: elc
        steps:
            - uses: actions/download-artifact@v4 # this also checks out our whole repo cuz we uploaded everything on . that we had
              with:
                  name: elc
            - name: compileth
              run: |
                  ls -la
                  chmod +x elc tools/gen_scratch_sb3.sh
                  ./elc -scratch3 patata.c > patata.json
                  ./tools/gen_scratch_sb3.sh patata.json -name out
            - name: upload artifact to internet archive ig
              uses: actions/upload-artifact@v4
              with:
                  name: output
                  path: ./